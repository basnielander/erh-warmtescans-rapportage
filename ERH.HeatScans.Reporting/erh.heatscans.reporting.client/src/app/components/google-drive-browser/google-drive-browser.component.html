<div class="google-drive-browser">
  <div class="header">
    <h2>Google Drive Browser</h2>
    <div *ngIf="folderStructure && !isLoading" class="actions">
      <button (click)="expandAll()" class="btn-action">Expand All</button>
      <button (click)="collapseAll()" class="btn-action">Collapse All</button>
      <button (click)="loadFolderStructure()" class="btn-action">Refresh</button>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading folder structure...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadFolderStructure()">Retry</button>
  </div>

  <div *ngIf="folderStructure && !isLoading" class="folder-structure">
    <!-- Root folder -->
    <div class="tree-item root-item">
      <div class="item-header" (click)="toggleFolder(folderStructure.id)">
        <span class="expand-icon">
          {{ isFolderExpanded(folderStructure.id) ? 'â–¼' : 'â–¶' }}
        </span>
        <span class="item-icon folder-icon">ğŸ“</span>
        <span class="item-name">{{ folderStructure.name }}</span>
        <span class="item-info" *ngIf="folderStructure.children">
          ({{ getItemCount(folderStructure).folders }} folders, {{ getItemCount(folderStructure).files }} files)
        </span>
      </div>
      
      <!-- Root metadata -->
      <div class="item-meta">
        <span class="meta-item">ID: {{ folderStructure.id }}</span>
        <span *ngIf="folderStructure.modifiedTime" class="meta-item">
          Modified: {{ folderStructure.modifiedTime | date:'short' }}
        </span>
      </div>

      <!-- Root children -->
      <div *ngIf="isFolderExpanded(folderStructure.id) && folderStructure.children && folderStructure.children.length > 0" 
           class="tree-children">
        <ng-container *ngFor="let item of folderStructure.children">
          <ng-container *ngTemplateOutlet="treeNode; context: { item: item, level: 1 }"></ng-container>
        </ng-container>
      </div>

      <!-- Empty state -->
      <div *ngIf="isFolderExpanded(folderStructure.id) && (!folderStructure.children || folderStructure.children.length === 0)" 
           class="empty-folder">
        <span class="empty-icon">ğŸ“­</span>
        <span>This folder is empty</span>
      </div>
    </div>
  </div>
</div>

<!-- Recursive template for tree nodes -->
<ng-template #treeNode let-item="item" let-level="level">
  <div class="tree-item" [style.padding-left.px]="level * 20">
    
    <!-- Folder item -->
    <div *ngIf="item.isFolder" class="item-header folder" (click)="toggleFolder(item.id)">
      <span class="expand-icon" *ngIf="item.children && item.children.length > 0">
        {{ isFolderExpanded(item.id) ? 'â–¼' : 'â–¶' }}
      </span>
      <span class="expand-icon placeholder" *ngIf="!item.children || item.children.length === 0"></span>
      <span class="item-icon folder-icon">ğŸ“</span>
      <span class="item-name">{{ item.name }}</span>
      <span class="item-info" *ngIf="item.children && item.children.length > 0">
        ({{ getItemCount(item).folders }} folders, {{ getItemCount(item).files }} files)
      </span>
      <span *ngIf="item.modifiedTime" class="item-modified">
        {{ item.modifiedTime | date:'short' }}
      </span>
    </div>

    <!-- File item -->
    <div *ngIf="!item.isFolder" class="item-header file">
      <span class="expand-icon placeholder"></span>
      <span class="item-icon file-icon">{{ getFileIcon(item.mimeType) }}</span>
      <span class="item-name">{{ item.name }}</span>
      <span *ngIf="item.size" class="item-size">{{ formatFileSize(item.size) }}</span>
      <span *ngIf="item.modifiedTime" class="item-modified">
        {{ item.modifiedTime | date:'short' }}
      </span>
    </div>

    <!-- Folder children (recursive) -->
    <div *ngIf="item.isFolder && isFolderExpanded(item.id) && item.children && item.children.length > 0" 
         class="tree-children">
      <ng-container *ngFor="let child of item.children">
        <ng-container *ngTemplateOutlet="treeNode; context: { item: child, level: level + 1 }"></ng-container>
      </ng-container>
    </div>

    <!-- Empty folder indicator -->
    <div *ngIf="item.isFolder && isFolderExpanded(item.id) && (!item.children || item.children.length === 0)"
         class="empty-folder"
         [style.padding-left.px]="(level + 1) * 20">
      <span class="empty-icon">ğŸ“­</span>
      <span>Empty folder</span>
    </div>
  </div>
</ng-template>
