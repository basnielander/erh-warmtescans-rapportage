<div class="report-container">
  <div class="report-header">
    <button (click)="goBack()" class="btn-back">â† Back to Browser</button>
    <h2>ğŸ“Š Report: {{ folderName() }}</h2>
  </div>

  <!-- Setup Status -->
  <div *ngIf="isSettingUp()" class="setup-status loading">
    <div class="spinner"></div>
    <p>Setting up address folder...</p>
  </div>

  <div *ngIf="setupError()" class="setup-status error">
    <p>âš ï¸ {{ setupError() }}</p>
    <button (click)="setupAddressFolder()" class="btn-retry">Retry Setup</button>
  </div>

  <!-- Report Loading Status -->
  <div *ngIf="isLoadingReport()" class="setup-status loading">
    <div class="spinner"></div>
    <p>Loading report...</p>
  </div>

  <div *ngIf="reportError()" class="setup-status error">
    <p>âš ï¸ {{ reportError() }}</p>
    <button (click)="loadReport()" class="btn-retry">Retry Loading Report</button>
  </div>

  <div class="report-content" *ngIf="!isSettingUp() && !isLoadingReport()">
    <div class="map-section">
      <h3>ğŸ“ Location Map</h3>
      <app-map-display [address]="folderName()"></app-map-display>
    </div>

    <div class="info-section">
      <h3>â„¹ï¸ Folder Information</h3>
      <div class="info-item">
        <strong>Folder Name:</strong> {{ folderName() }}
      </div>
      <div class="info-item">
        <strong>Folder ID:</strong> {{ folderId() }}
      </div>
      <div class="info-item" *ngIf="addressReport()">
        <strong>Total Images:</strong> {{ sortedImages().length }}
      </div>
    </div>

    <!-- Images Section -->
    <div class="images-section" *ngIf="addressReport() && sortedImages().length > 0">
      <h3>ğŸ–¼ï¸ Images in "2. Bewerkt" Folder</h3>
      <div class="update-status" *ngIf="isUpdatingIndices()">
        <div class="spinner-small"></div>
        <span>Updating order...</span>
      </div>
      <div class="images-grid">
        <div 
          *ngFor="let image of sortedImages(); let i = index"
          class="image-wrapper"
          [class.dragging]="draggedIndex() === i"
          draggable="true"
          (dragstart)="onDragStart($event, i)"
          (dragover)="onDragOver($event)"
          (drop)="onDrop($event, i)"
          (dragend)="onDragEnd()">
          <div class="drag-handle">â‹®â‹®</div>
          <app-image-card 
            [image]="image"
            (toggleExclude)="onToggleExcludeImage($event)">
          </app-image-card>
        </div>
      </div>
    </div>

    <!-- Excluded Images Section -->
    <div class="images-section excluded-section" *ngIf="addressReport() && excludedImages().length > 0">
      <h3>ğŸ—‘ï¸ Excluded Images</h3>
      <p class="section-description">These images have been excluded from the report.</p>
      <div class="images-grid">
        <div 
          *ngFor="let image of excludedImages(); let i = index"
          class="image-wrapper excluded">
          <app-image-card 
            [image]="image"
            (toggleExclude)="onToggleExcludeImage($event)">
          </app-image-card>
        </div>
      </div>
    </div>

    <!-- No Images Message -->
    <div class="no-images" *ngIf="addressReport() && sortedImages().length === 0 && excludedImages().length === 0">
      <p>ğŸ“­ No images found in the "2. Bewerkt" folder.</p>
    </div>
  </div>
</div>
