<div class="image-card">
  <div class="image-info">
    <div class="image-name" [title]="image().name">{{ image().name }}</div>
    <div class="image-meta">
      <span *ngIf="image().size" class="image-size">{{ formatFileSize(image().size) }}</span>
      <span *ngIf="image().modifiedTime" class="image-date">
        {{ image().modifiedTime | date:'short' }}
      </span>
      <span *ngIf="currentImage()?.dateTaken" class="image-date-taken">
        ğŸ“… Taken: {{ currentImage()!.dateTaken | date:'short' }}
      </span>
      <span *ngIf="currentImage()?.spots && currentImage()!.spots.length > 0" class="image-spots">
        ğŸ¯ Spots: {{ currentImage()!.spots.length }}
      </span>
    </div>

    <!-- Temperature Spots List -->
    <div *ngIf="currentImage()?.spots && currentImage()!.spots.length > 0" class="spots-list">
      <div class="spots-header">
        <span class="spots-title">ğŸŒ¡ï¸ Metingen</span>
      </div>
      <div class="spots-items">
        <div *ngFor="let spot of currentImage()!.spots" class="spot-item">
          <div class="spot-details">
            <span class="spot-name">{{ spot.name }}</span>
            <span class="spot-temperature">{{ spot.temperature }}</span>
          </div>
          <button 
            class="btn-delete-spot"
            (click)="onDeleteSpotClick($event, spot.name)"
            title="Delete spot">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    </div>

    <!-- Image Edit Form Component -->
    <app-image-edit-form
      [imageId]="image().id"
      [originalComment]="image().comments || ''"
      [originalOutdoor]="image().outdoor ?? true"
      (save)="onFormSave($event)"
      (cancel)="onFormCancel()"
    />
  </div>
  
  <div class="image-section">
    <div class="image-and-scale-wrapper">
      <div class="image-container">
        <img 
          *ngIf="imageUrl() && !isLoading() && !hasError()"
          [src]="imageUrl()!" 
          [alt]="image().name"
          [title]="image().name"
          class="image-thumbnail"
          loading="lazy"
          (click)="onImageClick($event)"
        />
        <div *ngIf="isLoading()" class="image-loading">
          <div class="spinner-small"></div>
          <p>Loading...</p>
        </div>
        <div *ngIf="hasError()" class="image-error">
          <p>âš ï¸ Failed to load</p>
        </div>
      </div>

      <!-- Image Scale Component -->
      <div class="scale-container" *ngIf="currentImage()?.scale">
        <app-image-scale [imageScale]="currentImage()!.scale!" />
      </div>
    </div>

    <!-- Daylight Photo Display -->
    @if (currentImage()?.daylightPhotoData) {
      <div class="daylight-photo-container">
        <img 
          [src]="'data:' + currentImage()!.mimeType + ';base64,' + currentImage()!.daylightPhotoData"
          [alt]="'Daylight photo of ' + image().name"
          class="daylight-photo-image"
          loading="lazy"
        />
      </div>
    }

    <!-- Exclude/Include Button (View Mode - shown below image) -->
    <div *ngIf="!isEditing()" class="image-actions-below">
      <div class="action-buttons">
        <button 
          *ngIf="!image().excludeFromReport"
          class="btn-exclude" 
          (click)="onToggleExcludeClick($event)"
          title="Exclude from report">
          ğŸ—‘ï¸ Exclude
        </button>
        <button 
          *ngIf="image().excludeFromReport"
          class="btn-include" 
          (click)="onToggleExcludeClick($event)"
          title="Include in report">
          â†©ï¸ Include
        </button>
      </div>
    </div>
  </div>
</div>
